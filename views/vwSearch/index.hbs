<link rel='stylesheet' href='/public/css/home.css' />
<link rel='stylesheet' href='/public/css/search.css' />
<link rel='stylesheet' href='/public/css/badge.css' />
<link rel="stylesheet" href="/public/css/pagination.css">

<div class='container-lg ml-4 mr-4 mb-5' style='margin-top: 100px; min-height: 1000px'>
    <div class="overlay-screen hidden-overlay"></div>
    <div class='row'>
        <div class='col-3 result-count dumb'>
            <div class="row">
                <div class="col">{{totalResult}} results for “{{key}}”</div>
            </div> 
        </div>
        
        <div class='col-3 my-sidebar'>
            <div id='accordion' class='myaccordion'>
                <div class="col-auto" style="text-align: right;"><a style="z-index: 999;" id="btn-collapse" href="#"><i class="bi bi-x-lg" style="font-size: 24px"></i></a></div>
                <div class='card'>
                    <div class='card-header' id='headingOne'>
                        <h2 class='mb-0'>
                            <button class='d-flex align-items-center justify-content-between btn btn-link'
                                data-toggle='collapse' data-target='#collapseOne' aria-expanded='true'
                                aria-controls='collapseOne'>
                                <i class="bi bi-search"></i>
                                Find by
                                <span class='fa-stack fa-sm'>
                                    <i class='fas fa-circle fa-stack-2x'></i>
                                    <i class='fas fa-minus fa-stack-1x fa-inverse'></i>
                                </span>
                            </button>
                        </h2>
                    </div>
                    
                    <div id='collapseOne' class='collapse show' aria-labelledby='headingOne' data-parent='#accordion'>
                        <div class='card-body'>
                            <ul>
                                <li>
                                    <div class="wrapper d-flex justify-content-center align-items-center">
                                        <input type="checkbox" name="filter_name" id=""  disabled {{#if findByName}}checked{{/if}}>  
                                        <a {{#unless findByName}}href="{{url}}&byName=1"{{/unless}} type="button" class="btn">Course Name</a>  
                                    </div>                                    
                                </li>
                                <li>
                                    <div class="wrapper d-flex justify-content-center align-items-center">
                                        <input type="checkbox" name="filter_name" id="" disabled  {{#if findByCat}}checked{{/if}}>  
                                        <a {{#unless findByCat}}href="{{url}}&byCat=1"{{/unless}} type="button" class="btn">Category</a> 
                                    </div>                                    
                                </li>                                                              
                            </ul>
                        </div>
                    </div>
                </div>
                <div class='card'>
                    <div class='card-header' id='headingTwo'>
                        <h2 class='mb-0'>
                            <button class='d-flex align-items-center justify-content-between btn btn-link'
                                data-toggle='collapse' data-target='#collapseTwo' aria-expanded='true'
                                aria-controls='collapseTwo'>
                                <i class="bi bi-star-fill"></i>
                                Ratings
                                <span class='fa-stack fa-sm'>
                                    <i class='fas fa-circle fa-stack-2x'></i>
                                    <i class='fas fa-minus fa-stack-1x fa-inverse'></i>
                                </span>
                            </button>
                        </h2>
                    </div>
                    <div id='collapseTwo' class='collapse show' aria-labelledby='headingTwo' data-parent='#accordion'>
                        <div class='card-body'>
                            <ul>
                                {{#if (isAsc ratingOption)}}
                                <li>
                                    <div class="wrapper d-flex justify-content-center align-items-center">
                                        <input type="radio" name="filter_price_asc" id="1" disabled checked>  
                                        <a type="button" class="btn">Ascending</a>  
                                    </div>                                    
                                </li>                                
                                <li>
                                    <div class="wrapper d-flex justify-content-center align-items-center">
                                        <input type="radio" name="filter_price_des" id="1" disabled>  
                                        <a href="{{url}}&ratingOption=des" type="button" class="btn">Descending</a>  
                                    </div>                                    
                                </li>
                                {{else}}
                                    {{#if (isDes ratingOption)}}
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_asc" id="1" disabled>  
                                                <a href="{{url}}&ratingOption=asc" type="button" class="btn">Ascending</a>  
                                            </div>                                    
                                        </li>                                
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_des" id="1" disabled checked>  
                                                <a type="button" class="btn">Descending</a>  
                                            </div>                                    
                                        </li>
                                    {{else}}
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_asc" id="1" disabled>  
                                                <a href="{{url}}&ratingOption=asc" type="button" class="btn">Ascending</a>  
                                            </div>                                    
                                        </li>                                
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_des" id="1" disabled >  
                                                <a href="{{url}}&ratingOption=des"  type="button" class="btn">Descending</a>  
                                            </div>                                    
                                        </li>
                                    {{/if}}
                                {{/if}}
                                
                            </ul>
                        </div>
                    </div>
                </div>
                <div class='card'>
                    <div class='card-header' id='headingThree'>
                        <h2 class='mb-0'>
                            <button class='d-flex align-items-center justify-content-between btn btn-link collapsed'
                                data-toggle='collapse' data-target='#collapseThree' aria-expanded='false'
                                aria-controls='collapseThree'>
                                <i class="bi bi-tag-fill"></i>
                                Price
                                <span class='fa-stack fa-2x'>
                                    <i class='fas fa-circle fa-stack-2x'></i>
                                    <i class='fas fa-minus fa-stack-1x fa-inverse'></i>
                                </span>
                            </button>
                        </h2>
                    </div>
                    <div id='collapseThree' class='collapse show' aria-labelledby='headingThree' data-parent='#accordion'>
                        <div class='card-body'>
                            <ul>
                                {{#if (isAsc priceOption)}}
                                <li>
                                    <div class="wrapper d-flex justify-content-center align-items-center">
                                        <input type="radio" name="filter_price_asc" id="1" disabled checked>  
                                        <a type="button" class="btn">Ascending</a>  
                                    </div>                                    
                                </li>                                
                                <li>
                                    <div class="wrapper d-flex justify-content-center align-items-center">
                                        <input type="radio" name="filter_price_des" id="1" disabled>  
                                        <a href="{{url}}&priceOption=des" type="button" class="btn">Descending</a>  
                                    </div>                                    
                                </li>
                                {{else}}
                                    {{#if (isDes priceOption)}}
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_asc" id="1" disabled>  
                                                <a href="{{url}}&priceOption=asc" type="button" class="btn">Ascending</a>  
                                            </div>                                    
                                        </li>                                
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_des" id="1" disabled checked>  
                                                <a type="button" class="btn">Descending</a>  
                                            </div>                                    
                                        </li>
                                    {{else}}
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_asc" id="1" disabled>  
                                                <a href="{{url}}&priceOption=asc" type="button" class="btn">Ascending</a>  
                                            </div>                                    
                                        </li>                                
                                        <li>
                                            <div class="wrapper d-flex justify-content-center align-items-center">
                                                <input type="radio" name="filter_price_des" id="1" disabled >  
                                                <a href="{{url}}&priceOption=des"  type="button" class="btn">Descending</a>  
                                            </div>                                    
                                        </li>
                                    {{/if}}
                                {{/if}}
                                
                            </ul>
                        </div>
                    </div>
                </div>
                {{#if isFilter}}
                    <div class='card'>
                    <a href="/search?k={{key}}&byName=1">
                        <div class='card-header' id='headingThree'>
                            <h2 class='mb-0'>
                                <button class='d-flex align-items-center justify-content-between btn btn-link collapsed'
                                    data-toggle='collapse' data-target='#collapseThree' aria-expanded='false'
                                    aria-controls='collapseThree'>
                                    <i class="bi bi-eraser-fill"></i>
                                    Remove Filter
                                    <span class='fa-stack fa-2x' style="">
                                        <i class='fas fa-plus fa-stack-1x fa-inverse'></i>
                                    </span>
                                </button>
                            </h2>
                        </div>
                    </a>
                </div>
                {{/if}}
                
            </div>
        </div>
        <div class="col-auto " style="text-align: right;"><a class="hidden" style="z-index: 999;" id="btn-open" href="#"><i class="bi bi-list" style="font-size: 24px; color: black;"></i></a></div>
        <div class='col ml-5'>
            
            {{#unless length}}
                <h1>Sorry, we couldn't find any results for "{{key}}"</h1>
                <h5>Try adjusting your search. Here are some ideas:</h5>
                <ul style="list-style-type: disc;">
                    <li>Make sure all words are spelled correctly</li>
                    <li>Add more search field in 'Find by' filter</li>
                    <li>Try different search terms</li>
                    <li>Try more general search terms</li>
                </ul>
            {{else}}
            <a type="button" href="#anchor" class="anchorBtn" style="display: none;"></a>
            <div class="outstanding-course">
                <p>Especial courses</p>
            </div>
                {{#if newestCourse}}
                <div class='row'>
                    <div class='card mb-3' style="flex:1">
                        <span class='text-muted product-category'>{{newestCourse.TopicName}}</span>
                        <div class='row no-gutters'>
                            <div class='col-md-3 fix-width' style='max-height: 227px'>
                                <div class="badge-overlay">
                                    <span class="top-left badge pink">Newest Course</span>
                                </div>
                                <img src='/public/images/courses/{{newestCourse.ID}}.jpg'
                                    style='object-fit: fill; width: 100%; height: 100%' alt='...' />
                            </div>
                            <div class='col' style='max-height: 227px'>
                                <div class='card-body'>
                                    <h5 class='card-title product-title'>{{newestCourse.Name}}</h5>
                                    
                                    <small class='text-muted'>By: {{newestCourse.Instructor}}</small>
                                    <small class='text-muted'>{{convertMinuteToHour newestCourse.TotalLength}} to learn. {{newestCourse.TotalLecture}} lectures</small>
                                    <p class='tinyDesc' style='margin-top: 16px;'>{{newestCourse.TinyDesc}}</p>
                                    <div class='rating mt-1' rating_score={{#if newestCourse.AvgRating}}{{newestCourse.AvgRating}}{{else}}0{{/if}} rating_count={{newestCourse.CountRating}}>
                                    </div>
                                    <div class='product-price-wrapper mt-1'>
                                        {{#if newestCourse.PercentDiscount}}
                                            <span class="old-price ">{{formatCurrency newestCourse.CourseFee}}</span>
                                        {{/if}}
                                        <span class="new-price float-right" style="font-size: 22px;">{{formatCurrency (calculateNewPrice newestCourse.PercentDiscount newestCourse.CourseFee)}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>  
                </div> 
                {{/if}}
                {{#if bestRatingCourse}}
                <div class='row'>
                    <div class='card mb-3' style="flex:1">
                        <span class='text-muted product-category'>{{bestRatingCourse.TopicName}}</span>
                        <div class='row no-gutters'>
                            <div class='col-md-3 fix-width' style='max-height: 227px'>
                                <div class="badge-overlay">
                                    <span class="top-left badge orange">High Rating</span>
                                </div>
                                <img src='/public/images/courses/{{bestRatingCourse.ID}}.jpg'
                                    style='object-fit: fill; width: 100%; height: 100%' alt='...' />
                            </div>
                            <div class='col' style='max-height: 227px'>
                                <div class='card-body'>
                                    <h5 class='card-title product-title'>{{bestRatingCourse.Name}}</h5>
                                    
                                    <small class='text-muted'>By: {{bestRatingCourse.Instructor}}</small>
                                    <small class='text-muted'>{{convertMinuteToHour bestRatingCourse.TotalLength}} to learn. {{bestRatingCourse.TotalLecture}} lectures</small>
                                    <p class='tinyDesc' style='margin-top: 16px;'>{{bestRatingCourse.TinyDesc}}</p>
                                    <div class='rating mt-1' rating_score={{#if bestRatingCourse.AvgRating}}{{bestRatingCourse.AvgRating}}{{else}}0{{/if}} rating_count={{bestRatingCourse.CountRating}}>
                                    </div>
                                    <div class='product-price-wrapper mt-1'>
                                        {{#if bestRatingCourse.PercentDiscount}}
                                            <span class="old-price ">{{formatCurrency bestRatingCourse.CourseFee}}</span>
                                        {{/if}}
                                        <span class="new-price float-right" style="font-size: 22px;">{{formatCurrency (calculateNewPrice bestRatingCourse.PercentDiscount bestRatingCourse.CourseFee)}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>  
                </div> 
                {{/if}}
                {{#if bestSellCourse}}
                <div class='row'>
                    <div class='card mb-3' style="flex:1">
                        <span class='text-muted product-category'>{{bestSellCourse.TopicName}}</span>
                        <div class='row no-gutters'>
                            <div class='col-md-3 fix-width' style='max-height: 227px'>
                                <div class="badge-overlay">
                                    <span class="top-left badge red">Super Discount</span>
                                </div>
                                <img src='/public/images/courses/{{bestSellCourse.ID}}.jpg'
                                    style='object-fit: fill; width: 100%; height: 100%' alt='...' />
                            </div>
                            <div class='col' style='max-height: 227px'>
                                <div class='card-body'>
                                    <h5 class='card-title product-title'>{{bestSellCourse.Name}}</h5>
                                    
                                    <small class='text-muted'>By: {{bestSellCourse.Instructor}}</small>
                                    <small class='text-muted'>{{convertMinuteToHour bestSellCourse.TotalLength}} to learn. {{bestSellCourse.TotalLecture}} lectures</small>
                                    <p class='tinyDesc' style='margin-top: 16px;'>{{bestSellCourse.TinyDesc}}</p>
                                    <div class='rating mt-1' rating_score={{#if bestSellCourse.AvgRating}}{{bestSellCourse.AvgRating}}{{else}}0{{/if}} rating_count={{bestSellCourse.CountRating}}>
                                    </div>
                                    <div class='product-price-wrapper mt-1'>
                                        {{#if bestSellCourse.PercentDiscount}}
                                            <span class="old-price ">{{formatCurrency bestSellCourse.CourseFee}}</span>
                                        {{/if}}
                                        <span class="new-price float-right" style="font-size: 22px;">{{formatCurrency (calculateNewPrice bestSellCourse.PercentDiscount bestSellCourse.CourseFee)}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>  
                </div> 
                {{/if}}
            <div id="anchor"></div>
            
            <div class="outstanding-course mt-5">
                <p>Relevent Course</p>
            </div>
            <div class="container">
                <div class="row">
                {{#each result as |course|}}
                    <div class="col-auto mt-3">
                    <div class="card product-item popover-{{course.ID}}" style="max-width:250px; min-width:250px" >
                        <img src="/public/images/courses/{{course.ID}}.jpg" width="250" height="150" style="object-fit: fill;"
                            class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title product-title">{{course.Name}}</h5>
                            <span class="text-muted product-category">{{course.TopicName}}</span>
                            <small class="text-muted">Ins: {{course.Instructor}}</small>
                            <div class="rating mt-1" rating_score={{#if course.AvgRating}}{{course.AvgRating}}{{else}}0{{/if}} rating_count={{course.CountRating}}>
                            </div>
                            <div class="product-price-wrapper mt-3">
                            {{#if course.PercentDiscount}}
                                <span class="old-price ">{{formatCurrency course.CourseFee}}</span>
                            {{/if}}
                            <span class="new-price float-right" style="font-size: 22px;">{{formatCurrency (calculateNewPrice course.PercentDiscount course.CourseFee)}}</span>
                            </div>
                        </div>
                    </div>                    
                </div>
                {{/each}}
                </div>
            </div>  
            <div class="page-container">
                <a class="first-page">
                <i class="fas fa-angle-double-left"></i>
                </a>
                <a class="prev-page">
                <i class="fas fa-angle-left"></i>
                </a>
                <div id="pagination"></div>
                <a class="next-page">
                <i class="fas fa-angle-right"></i>
                </a>
                <a class="last-page">
                <i class="fas fa-angle-double-right"></i>
                </a>
            </div>
                    {{/unless}}
        </div>
        
    </div>

</div>

{{#section 'script'}}
<script>
    let myFilter = document.querySelector('.my-sidebar'); let footer =
        document.querySelector('footer'); 
        let offsetTop = myFilter.offsetTop;
        window.onscroll = (e) => {
        let scroll = window.scrollY ;
        let move = offsetTop + scroll; 
        if (move + myFilter.clientHeight >= footer.offsetTop) {
                move = footer.offsetTop - myFilter.clientHeight - 50;
        } 
        myFilter.style['top'] = move + 'px';
    } 
    $("#accordion").on('hide.bs.collapse show.bs.collapse', e => {
        $(e.target).prev().find('i:last-child').toggleClass('fa-minus fa-plus'); 
    });

  {{#each result as |course|}}
    $(".popover-{{course.ID}}").popover({
      trigger: 'hover',
      container: 'body',
      html: true,
      title: "<i>{{course.Name}}</i>",
      content: `
        <div class="d-flex justify-content-between">
            <small class="total-lecture">{{course.TotalLecture}} Lectures</small>
            <small class="total-hour">{{convertMinuteToHour course.TotalLength}} to learn</small>
        </div>
        
        <br>
        <h6>About course: </h6>
        {{{course.FullDesc}}}
      `
  })
  {{/each}}
  


</script>
{{/section}}

<script src='/public/script/rating.js'></script>
<script>
    {{#if length}} renderRating('.rating'){{/if}}
       
</script>
<script src="/public/script/pagination.js"></script>
<script>
    {{#if length}}
    const valuePage = {
        totalPages: {{totalPage}},
        curPage: {{currentPage}},
        truncate: true,
       numLinksTwoSide: 1,
       url: `{{url}}`
       
     };
     pagination(valuePage);
    {{/if}}
    
</script>

<script>
    {{#if anchor}}
        let a = document.querySelector(".anchorBtn")
    a.click();
    {{/if}} 

</script>

<script>
    let collapse = document.querySelector('#btn-collapse');
    let open = document.querySelector('#btn-open');
    let dumb = document.querySelector('.dumb');
    let sidebar = document.querySelector('.my-sidebar');
    let overlay = document.querySelector('.overlay-screen');
    collapse.onclick = ()=>{
        dumb.classList.toggle('collapse-active');
        sidebar.classList.toggle('collapse-active');
        open.classList.remove('hidden');
         overlay.classList.add('hidden-overlay')
    }
    open.onclick = ()=>{
        dumb.classList.toggle('collapse-active');
        sidebar.classList.toggle('collapse-active');
        open.classList.add('hidden')
        overlay.classList.remove('hidden-overlay')
    }
    overlay.onclick = ()=>{
        dumb.classList.toggle('collapse-active');
        sidebar.classList.toggle('collapse-active');
        open.classList.remove('hidden');
         overlay.classList.add('hidden-overlay')
    }
    let width = window.innerWidth;
    if(width <= 992){
        dumb.classList.add('collapse-active');
        sidebar.classList.add('collapse-active');
        open.classList.remove('hidden');
    }
</script>